# lf-windows 用户使用手册

[English Documentation](README.md)

## 1. 简介
`lf-windows` 是一款专为 Windows 11 设计的现代终端文件管理器，复刻了 `lf` 的核心体验，并针对 Windows 桌面环境进行了深度优化。它采用键盘优先的操作逻辑，结合了 Vim 风格的快捷键，旨在提供高效、沉浸式的文件管理体验。

## 2. 核心界面
界面采用经典的三栏布局（Miller Columns）：
- **左栏 (Parent)**: 显示当前目录的父级目录内容。
- **中栏 (Current)**: 显示当前工作目录的内容，支持高亮选中项。
- **右栏 (Preview)**: 显示选中文件的预览内容（支持文本、图片、视频、PDF、Office文档、压缩包等）。

底部包含：
- **状态栏**: 显示当前文件信息、选中项数量、过滤状态等。
- **命令行**: 用于输入命令、搜索模式和过滤模式的交互。

## 3. 基础操作

### 3.1 导航
| 动作 | 快捷键 | 说明 |
| :--- | :--- | :--- |
| 上移 | `k` 或 `Up` | 向上移动光标 |
| 下移 | `j` 或 `Down` | 向下移动光标 |
| 进入目录/打开文件 | `l` 或 `Right` | 进入选中目录或打开文件 |
| 返回上级目录 | `h` 或 `Left` | 返回父级目录 |
| 顶部 | `gg` | 跳转到列表顶部 |
| 底部 | `G` | 跳转到列表底部 |
| 向上半页 | `Ctrl+U` | 向上滚动半页 |
| 向下半页 | `Ctrl+D` | 向下滚动半页 |
| 向上整页 | `Ctrl+B` | 向上滚动一页 |
| 向下整页 | `Ctrl+F` | 向下滚动一页 |

### 3.2 文件操作
| 动作 | 快捷键 | 说明 |
| :--- | :--- | :--- |
| 复制 (Yank) | `y` | 将选中文件加入剪贴板（复制模式） |
| 剪切 (Cut) | `x` | 将选中文件加入剪贴板（移动模式） |
| 粘贴 (Paste) | `p` | 将剪贴板中的文件粘贴到当前目录 |
| 删除 | `Delete` 或 `D` | 将选中文件移动到回收站 |
| 重命名 | `r` | 重命名当前文件 |
| 新建文件 | `n` | 在当前目录新建文件 |
| 新建文件夹 | `N` | 在当前目录新建文件夹 |
| 创建快捷方式 | `Ctrl+L` | 为剪贴板中的文件创建快捷方式 |
| 清除剪贴板 | `c` | 清空当前剪贴板状态 |
| 查看剪贴板历史 | `P` | 打开剪贴板历史面板 (Yank History) |

### 3.3 选择操作
| 动作 | 快捷键 | 说明 |
| :--- | :--- | :--- |
| 切换选中 | `Space` | 选中/取消选中当前项，并下移 |
| 可视化模式 | `V` | 进入/退出可视化选择模式 (Visual Mode) |
| 全选/反选 | `v` | 反转当前目录的选择状态 |
| 取消全选 | `u` | 取消所有选中项 |

## 4. 搜索与过滤 (核心功能)

`lf-windows` 提供了强大的搜索和过滤功能，支持四种匹配模式。所有模式默认**忽略大小写**，且支持**中文拼音首字母**匹配。

#### 匹配模式详解

| 模式 | 关键词 | 说明 | 示例 |
| :--- | :--- | :--- | :--- |
| **Fuzzy** | `fuzzy` | **模糊匹配** (默认)。输入字符只需按顺序出现在文件名中即可匹配。适合快速查找。 | 输入 `doc` 可匹配 `Documents`、`d_o_c.txt` |
| **Text** | `text` | **文本包含**。文件名必须包含输入的完整子串。 | 输入 `log` 可匹配 `syslog.txt`，但不匹配 `l_o_g.txt` |
| **Glob** | `glob` | **通配符全字匹配**。使用 `*` 和 `?`。注意这是**全字匹配** (Anchored)。 | `*.txt` (所有txt文件), `data_??.dat` |
| **Regex** | `regex` | **正则表达式**。使用 .NET 正则表达式引擎进行复杂匹配。 | `^\d+` (数字开头), `(jpg|png)$` (图片后缀) |

> **提示**: 拼音匹配示例：在 Fuzzy 模式下输入 `wjj` 可以匹配 `文件夹 (WenJianJia)`。

#### 通配符使用指南 (Glob Guide)
Glob 模式采用标准的 Shell 通配符语法，但需要特别注意它是**全字匹配** (Full Match)。这意味着你的模式必须匹配**整个**文件名，而不仅仅是包含在其中。

| 符号 | 含义 | 示例 |
| :--- | :--- | :--- |
| `*` | 匹配任意数量的字符 (包括零个) | `*.txt` 匹配所有 txt 文件<br>`*report*` 匹配包含 report 的文件 |
| `?` | 匹配任意**单个**字符 | `img_??.jpg` 匹配 `img_01.jpg`, 但不匹配 `img_1.jpg` 或 `img_001.jpg` |

**常见误区**:
- 输入 `xml` **无法**匹配 `config.xml`。必须输入 `*.xml` 或 `*xml`。
- 输入 `test` **无法**匹配 `my_test_file`。必须输入 `*test*`。

#### 正则表达式参考 (Regex Reference)
在 Regex 模式下，支持以下常用符号（基于 .NET Regex 引擎）：

| 符号 | 含义 | 示例 |
| :--- | :--- | :--- |
| `.` | 匹配除换行符外的任意字符 | `a.c` 匹配 `abc`, `a+c` |
| `*` | 匹配前面的字符 0 次或多次 | `ab*c` 匹配 `ac`, `abc`, `abbc` |
| `+` | 匹配前面的字符 1 次或多次 | `ab+c` 匹配 `abc`, `abbc` (不匹配 `ac`) |
| `?` | 匹配前面的字符 0 次或 1 次 | `colou?r` 匹配 `color`, `colour` |
| `^` | 匹配字符串的**开头** | `^Log` 匹配以 `Log` 开头的文件 |
| `$` | 匹配字符串的**结尾** | `.txt$` 匹配以 `.txt` 结尾的文件 |
| `[]` | 字符集合，匹配括号内的任意一个字符 | `[abc]` 匹配 `a`, `b`, 或 `c` |
| `[^]` | 否定字符集合 | `[^0-9]` 匹配非数字字符 |
| `|` | 逻辑或 (OR) | `jpg|png` 匹配 `jpg` 或 `png` |
| `()` | 分组 | `(ab)+` 匹配 `ab`, `abab` |
| `\d` | 匹配数字 (等价于 `[0-9]`) | `file_\d+` 匹配 `file_123` |
| `\w` | 匹配单词字符 (字母、数字、下划线) | `\w+` |
| `\s` | 匹配空白字符 (空格、制表符等) | |

### 4.4 中文拼音支持 (Chinese Pinyin Support)
`lf-windows` 对中文文件名提供了深度的拼音支持，允许你使用英文字符快速筛选中文文件。

#### 1. Fuzzy 模式 (混合匹配)
在 Fuzzy 模式下，匹配是**逐字符**进行的。每个输入字符既可以匹配文件名的原始字符，也可以匹配该字符的拼音首字母。
- **特点**: 支持中英混合输入。
- **示例**: 文件名为 `我的文档.txt`
  - 输入 `wdwd` -> 匹配 (W-D-W-D)
  - 输入 `我dwd` -> 匹配 (我-D-W-D)
  - 输入 `w的wd` -> 匹配 (W-的-W-D)

#### 2. Text / Glob / Regex 模式 (双重匹配)
在这些模式下，系统会同时检测**原始文件名**和**拼音首字母字符串**。只要满足其中任意一个，即视为匹配。
- **原理**: 文件 `我的文档.txt` 会被视为两个目标：
  1. `我的文档.txt` (原始)
  2. `wdwd.txt` (拼音首字母)
  
- **示例**:
  - **Text**: 输入 `wd` 可以匹配 `我的文档` (因为 `wdwd` 包含 `wd`)。
  - **Glob**: 输入 `w*.txt` 可以匹配 `我的文档.txt` (因为 `wdwd.txt` 符合 `w*.txt`)。
  - **Regex**: 输入 `^w\w+d` 可以匹配 `我的文档` (因为 `wdwd` 符合正则)。

> **注意**: 拼音匹配仅支持**首字母**，不支持全拼。例如 `我的` 对应 `wd`，不支持 `wode`。

### 4.1 过滤模式 (Filter Mode)
过滤模式会实时隐藏不匹配的文件，只显示符合条件的项目。
- **进入过滤**: 按 `i` 键。
- **默认模式**: Fuzzy (模糊匹配)。
- **切换模式**: 在命令行输入 `:filter <模式> <内容>`。
  - 例: `:filter regex ^[0-9]+` (筛选以数字开头的文件)
  - 例: `:filter glob *.txt` (筛选 txt 文件)

### 4.2 搜索模式 (Search Mode)
搜索模式会在列表中高亮匹配项，并支持跳转，不会隐藏文件。
- **向下搜索**: 按 `/` 键。
- **向上搜索**: 按 `?` (即 `Shift+/`) 键。
- **下一个匹配**: `=` (注意：与标准 lf 的 `n` 不同，`n` 用于新建文件)。
- **上一个匹配**: `-` (注意：与标准 lf 的 `N` 不同，`N` 用于新建文件夹)。

### 4.3 快速查找 (Find Mode)
用于在当前屏幕内快速跳转。
- **查找字符**: 按 `f` 后跟任意字符，跳转到该字符下一次出现的位置。
- **反向查找**: 按 `F` 后跟任意字符，跳转到该字符上一次出现的位置。
- **重复查找**: `.` (下一个), `,` (上一个)。

## 5. 面板与工具

### 5.1 命令面板 (Command Panel)
- **快捷键**: `zz`
- **功能**: 弹出一个包含常用命令的网格面板，支持鼠标点击或键盘选择。
- **自定义**: 面板中的命令（如 Copy, Delete, Sort 等）可以在设置中自定义排序和增删。

### 5.2 书签与跳转 (Bookmarks & Jump)
- **保存书签**: 按 `m`，然后输入一个字符（如 `a`），将当前目录保存为书签 `a`。
- **跳转书签**: 按 `;` 然后输入书签字符（如 `a`），跳转到对应目录。
- **内置书签**: 程序可能预设了一些书签，可在跳转面板中查看。

### 5.3 工作区面板 (Workspace Panel)
- **快捷键**: `wo` (Toggle Workspace)
- **功能**: 工作区类似于“收藏夹分组”或“项目上下文”，允许你创建多个分组来管理常用的文件和目录快捷方式。面板分为左侧（工作区列表）和右侧（快捷方式列表）。

- **基础操作**:
  - `Tab`: 在左侧工作区列表和右侧快捷方式列表之间切换焦点。
  - `Esc`: 关闭面板。

- **工作区管理 (左侧焦点时)**:
  - `ws`: **新建**工作区 (Workspace New)。
  - `wr`: **重命名**当前工作区 (Workspace Rename)。
  - `wd`: **删除**当前工作区 (Workspace Delete)。
  - `j` / `k`: 上下切换工作区。
  - `1`-`9`: 快速跳转到对应序号的工作区。
  - `l`: 进入右侧快捷方式列表。

- **快捷方式管理 (右侧焦点时)**:
  - `Enter`: 打开选中的文件或进入目录。
  - `c`: **删除**选中的快捷方式 (Clear)。
  - `j` / `k`: 上下选择快捷方式。
  - `1`-`9`: 快速打开对应序号的快捷方式。
  - `h`: 返回左侧工作区列表。

- **添加内容到工作区**:
  1. 在主界面的文件列表中选中一个或多个文件/目录。
  2. 输入 `wl` (Workspace Link)。
  3. 面板会自动打开，选择目标工作区后按 `Enter` 确认。

### 5.4 剪贴板与历史 (Clipboard & History)

`lf-windows` 拥有一个强大的剪贴板系统，分为**当前剪贴板**和**剪贴板历史**。

#### 当前剪贴板 (Active Clipboard)
这是你当前准备粘贴的文件集合。
- **复制 (Yank)**: 按 `y` 将选中文件加入当前剪贴板。
- **剪切 (Cut)**: 按 `x` 将选中文件加入当前剪贴板（粘贴后会移动源文件）。
- **粘贴 (Paste)**: 按 `p` 将当前剪贴板的文件粘贴到当前目录。
- **清除 (Clear)**: 按 `c` 清空当前剪贴板（取消复制/剪切状态）。状态栏会显示当前剪贴板中的文件数量。

#### 剪贴板历史 (Yank History)
每次执行复制 (`y`) 或剪切 (`x`) 操作时，文件组都会被自动保存到历史记录中。你可以随时调出历史记录来重新使用之前复制过的文件。

- **打开面板**: 按 `P` (Shift+p)。
- **面板操作**:
  - `j` / `k` 或 `Up` / `Down`: 上下选择历史记录项。
  - `Enter` 或 `Space`: **确认并粘贴**。这将把选中的历史项重新激活为“当前剪贴板”，并立即执行粘贴操作。
  - `c`: **删除**选中的历史记录项。
  - `1`-`9`: 快速选择并粘贴对应序号的历史项。
  - `Esc`: 关闭面板。

### 5.5 视图与外观 (View & Appearance)
`lf-windows` 提供了多种视图模式以适应不同的使用场景，你可以通过命令面板 (`zz`) 或输入命令来切换这些状态。

- **浮动模式 (Float Mode)**
  - **命令**: `:float`
  - **说明**: 隐藏标准窗口标题栏，提供更沉浸的视觉体验。特别适合配合平铺式窗口管理器 (Tiling Window Manager) 使用，以最大化屏幕利用率。

- **紧凑模式 (Compact Mode)**
  - **命令**: `:compact`
  - **说明**: 减小文件列表项的行高和间距。在有限的屏幕空间内（如笔记本屏幕）可以显示更多的文件内容。

- **图标显示 (Icons)**
  - **命令**: `:icon`
  - **说明**: 切换文件类型图标的显示/隐藏。如果你偏好纯文本界面，或者希望进一步降低资源占用，可以关闭图标。

- **预览开关 (Preview Toggle)**
  - **命令**: `:preview`
  - **说明**: 开启或关闭右侧预览栏。
    - **开启**: 提供丰富的文件预览（文本、图片、PDF等）。
    - **关闭**: 界面变为两栏布局（父目录+当前目录）。关闭预览栏可以显著降低内存占用，并提升在包含大量大文件目录下的浏览速度。

### 5.6 文件监控与同步 (File Watcher & Sync)
`lf-windows` 采用独立的后台进程 `lf-watcher.exe` 来实现与 Windows 文件系统的实时同步。

#### 1. 独立进程架构 (lf-watcher)
为了保证主界面的极致流畅，我们将文件监控逻辑从主进程中剥离。
- **主程序 (`lf-windows.exe`)**: 专注于 UI 渲染、用户交互和预览生成。
- **监控进程 (`lf-watcher.exe`)**: 专注于监听文件系统的 `Create`, `Delete`, `Rename`, `Change` 事件，并通过 IPC 管道通知主程序。

#### 2. 与资源管理器同步 (Sync with Explorer)
得益于 `lf-watcher`，`lf-windows` 能够与 Windows 资源管理器（或其他文件管理工具）保持高度同步：
- **外部变更实时反映**: 当你在 Windows 资源管理器中新建、删除或重命名文件时，`lf-windows` 的文件列表会自动刷新，无需手动按 `F5`。
- **双向同步**: 同样，你在 `lf-windows` 中进行的操作也会立即反映在打开的资源管理器窗口中。
- **防卡顿设计**: 即使在包含数万个文件的目录中发生大量变更（例如解压大型压缩包），监控进程的繁忙也不会导致 `lf-windows` 主界面卡死。

#### 3. 故障排查
- **依赖关系**: `lf-watcher.exe` 必须与主程序 `lf-windows.exe` 位于同一目录下才能正常工作。
- **自动恢复**: 如果监控进程意外终止，主程序会尝试自动重启它。
- **手动检查**: 如果你发现文件列表不再自动刷新，请检查任务管理器中是否存在 `lf-watcher.exe` 进程。如果不存在，重启 `lf-windows` 通常可以解决问题。

## 6. 快捷键详解 (Keybindings)

本节按功能分类列出所有默认快捷键。你可以在 `config.yaml` 中自定义这些按键。

### 6.1 核心导航 (Navigation)
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `k` / `Up` | 上移 | |
| `j` / `Down` | 下移 | |
| `h` / `Left` | 返回上级目录 | |
| `l` / `Right` | 进入目录 / 打开文件 | |
| `gg` | 跳转到顶部 | |
| `G` | 跳转到底部 | |
| `Ctrl+U` | 向上滚动半页 | Up Half |
| `Ctrl+D` | 向下滚动半页 | Down Half |
| `Ctrl+B` | 向上滚动一页 | Back |
| `Ctrl+F` | 向下滚动一页 | Forward |
| `gh` | 跳转到用户主目录 | Go Home |

### 6.2 文件操作 (File Operations)
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `o` | 打开文件 | 使用系统默认程序打开 |
| `e` | 资源管理器打开 | Open in Explorer |
| `n` | 新建文件 | New File |
| `N` | 新建文件夹 | New Directory |
| `r` | 重命名 | Rename |
| `Delete` / `D` | 删除 | 移至回收站 |
| `F5` | 刷新 | 刷新当前目录 |

> **提示**: 打开终端 (Open Terminal) 功能默认未绑定快捷键，你可以通过命令面板 (`zz`) 选择 `open-terminal`，或在 `config.yaml` 中添加绑定 (例如 `Normal.OpenTerminal: w`)。

### 6.3 剪贴板操作 (Clipboard)
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `y` | 复制 (Yank) | 加入当前剪贴板 |
| `x` | 剪切 (Cut) | 加入当前剪贴板 (移动模式) |
| `p` | 粘贴 (Paste) | 将剪贴板内容粘贴到此处 |
| `c` | 清除 (Clear) | 清空当前剪贴板状态 |
| `Ctrl+L` | 创建快捷方式 | 为剪贴板内容创建 Link |
| `P` | 剪贴板历史 | 打开历史面板 (Shift+p) |

### 6.4 选择模式 (Selection)
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `Space` | 切换选中 | 选中/取消选中当前项，并下移 |
| `v` | 反选 | 反转当前目录所有项的选择状态 |
| `u` | 取消全选 | Unselect All |
| `V` | 可视化模式 | 进入 Visual Mode (类似 Vim) |
| `o` | 切换端点 | 交换光标位置与选择起始点 (Exchange) |

### 6.5 搜索与查找 (Search & Find)
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `/` | 向下搜索 | 进入搜索模式 |
| `?` | 向上搜索 | 进入搜索模式 (反向) |
| `=` | 下一个匹配 | Next Match |
| `-` | 上一个匹配 | Previous Match |
| `f` | 查找字符 | Find Char (当前屏内跳转) |
| `F` | 反向查找字符 | Find Char Back |
| `.` | 重复查找 (下) | Repeat Find Next |
| `,` | 重复查找 (上) | Repeat Find Prev |
| `i` | 过滤模式 | Filter Mode |

### 6.6 视图与排序 (View & Sort)
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `sn` | 按名称排序 | Sort Natural |
| `ss` | 按大小排序 | Sort Size |
| `st` | 按修改时间排序 | Sort Time (Modified) |
| `sa` | 按访问时间排序 | Sort Access Time |
| `sb` | 按创建时间排序 | Sort Birth Time |
| `sc` | 按变更时间排序 | Sort Change Time |
| `se` | 按扩展名排序 | Sort Extension |
| `zr` | 切换反向排序 | Toggle Reverse Sort |
| `zd` | 切换目录优先 | Toggle Directories First |
| `zh` | 显示/隐藏 隐藏文件 | Toggle Hidden |
| `z.` | 仅显示/隐藏 点文件 | Toggle Dotfiles Only |
| `zs` | 显示文件大小 | Info: Size |
| `zt` | 显示修改时间 | Info: Time |
| `za` | 显示大小和时间 | Info: Size & Time |
| `zp` | 显示权限 | Info: Permissions |
| `zn` | 清除信息列 | Info: None |
| `Alt+1` | 设置小窗口模式 | Small Window |
| `Alt+2` | 设置大窗口模式 | Large Window |
| `F11` | 切换全屏 | Toggle Fullscreen |

### 6.7 面板与特殊模式 (Panels)
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `zz` | 命令面板 | 打开常用命令网格 |
| `m` | 保存书签 | Mark (后跟一个字符) |
| `;` | 跳转书签 | Jump (后跟一个字符) |
| `wo` | 工作区面板 | 打开/关闭工作区 |
| `q` | 退出 | 退出程序或关闭当前面板 |

### 6.8 工作区面板专用键 (Workspace Mode)
当工作区面板 (`wo`) 打开时：
- **通用**: `Tab` (切换左右栏焦点), `Esc` (关闭)。
- **左栏 (工作区列表)**:
  - `ws`: 新建工作区。
  - `wr`: 重命名工作区。
  - `wd`: 删除工作区。
  - `l`: 进入右侧。
- **右栏 (快捷方式列表)**:
  - `Enter`: 打开选中项。
  - `c`: 删除选中项。
  - `h`: 返回左侧。

### 6.9 剪贴板历史专用键 (History Mode)
当剪贴板历史 (`P`) 打开时：
- `j` / `k`: 选择历史项。
- `Enter` / `Space`: **确认并粘贴**。
- `c`: **删除**选中项。
- `Esc`: 关闭面板。

### 6.10 预览与弹窗 (Preview & Popups)

#### 预览窗格 (Preview Pane)
在主界面的右侧预览栏中：
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `Up` / `Down` | 预览滚动 (上下) | 滚动右侧预览内容 |
| `Left` / `Right` | 预览滚动 (左右) | 滚动右侧预览内容 |
| `t` | 弹出预览窗口 | 在独立窗口中打开预览 |

#### 弹窗预览 (Popup Window)
当使用 `t` 打开独立预览窗口时：
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `j` / `Down` | 向下滚动 | |
| `k` / `Up` | 向上滚动 | |
| `h` | 向左旋转 | 图片预览有效 (-90°) |
| `l` | 向右旋转 | 图片预览有效 (+90°) |
| `Left` / `Right` | 翻页 | PDF 预览有效 |
| `Esc` | 关闭窗口 | |

#### 确认对话框 (Dialogs)
当出现确认提示（如删除文件）时：
| 快捷键 | 功能 | 备注 |
| :--- | :--- | :--- |
| `y` | 确认 (Yes) | 执行操作 |
| `n` | 取消 (No) | 取消操作 |
| `Esc` | 取消 | 取消操作 (保持选择状态) |

## 7. 配置与自定义
配置文件位于 `%APPDATA%\lf-windows\` 目录下（即 `C:\Users\用户名\AppData\Roaming\lf-windows\`）。
- **config.yaml**: 包含所有设置，包括通用设置、外观主题 (appearance) 和快捷键映射 (keyBindings)。

可以通过修改 `config.yaml` 中的 `keyBindings` 部分将快捷键恢复为标准 `lf` 习惯（例如将 `n` 改回搜索下一个，将新建文件改为其他键）。

## 8. 致谢与参考 (Credits)
`lf-windows` 的设计理念和核心交互逻辑深受 **lf** (List File Manager) 的启发。
- **lf**: [https://github.com/gokcehan/lf](https://github.com/gokcehan/lf)

感谢 `lf` 社区为终端文件管理器带来的优秀交互范式。`lf-windows` 致力于将这种高效的操作体验带入 Windows 原生 GUI 环境，同时保留其简洁、快速的特性。